import streamlit as st
from models.PDF_malware_detection.predict import predict_malware
import tempfile
import os

st.title("Malware Detection for PDF Files")

# Form for uploading the PDF file
uploaded_file = st.file_uploader("Upload a PDF file", type="pdf")

# Create a submit button
submit_button = st.button("Submit for Malware Detection")

if uploaded_file is not None and submit_button:
    st.info("Processing file... Please wait.")
    
    # Create a temporary file
    with tempfile.NamedTemporaryFile(delete=False, suffix=".pdf") as tmp_file:
        tmp_file.write(uploaded_file.getvalue())
        tmp_file_path = tmp_file.name

    try:
        # Pass the temporary file path to the predict_malware function
        result = predict_malware(tmp_file_path)
        
        if result == 1:
            st.error("Malicious PDF detected!")
        else:
            st.success("The PDF is clean!")

    except Exception as e:
        st.error(f"An error occurred during processing: {str(e)}")

    finally:
        # Clean up the temporary file
        os.unlink(tmp_file_path)

    # Display some information about the uploaded file
    st.subheader("File Information:")
    st.json({
        "Filename": uploaded_file.name,
        "File size": f"{uploaded_file.size} bytes",
        "File type": uploaded_file.type
    })

elif submit_button and uploaded_file is None:
    st.warning("Please upload a PDF file before submitting.")